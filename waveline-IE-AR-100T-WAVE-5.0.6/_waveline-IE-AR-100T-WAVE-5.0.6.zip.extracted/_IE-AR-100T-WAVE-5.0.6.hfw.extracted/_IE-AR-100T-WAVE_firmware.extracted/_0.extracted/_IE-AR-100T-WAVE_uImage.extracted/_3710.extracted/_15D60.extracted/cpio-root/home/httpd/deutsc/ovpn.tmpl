<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="author" content="Henry Jesuiter, Enrico Kalliwoda">
<meta name="description" content="English toc-page of the IAR / Heyfra GmbH">
<meta name="date" content="2005-06-10 11:00:00">
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-store">
<meta http-equiv="expires" content="0">
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<title>OpenVPN Konfiguration</title>
<link rel="stylesheet" type="text/css" href="css/stile.css" media="screen">
<style type="text/css">
<!--
div  { font-size:12px; position:absolute; top:40px; left:0px; height:auto; width:100%; visibility:hidden; }
-->
</style>
<script src="deutsc/auxfunc.js" type="text/javascript"></script>
<script type="text/javascript">
<!--

var onload_done = false;

function chooseDiv(number) {
//  for (i = 1;i < 5; ++i) {
  for (i = 1;i < 4; ++i) {
    document.getElementById(String(i)).style.visibility = (number==i ? "visible" : "hidden");
  }
  if (!onload_done) {
//    document.ovpnForm2.keymode[0].disabled = document.ovpnForm2.keymode[1].disabled =
//    document.ovpnForm2.newkey.disabled = document.ovpnForm2.loadkey.disabled =
//    document.ovpnForm2.Cancel_Button2.disabled = document.ovpnForm2.OK_Button2.disabled = (number==4) ? false : true;
//    document.ovpnForm2.Datei.disabled = (number==4 && document.ovpnForm2.keymode[1].checked) ? false : true;
    onload_done = true;
  }
}


function setkeystate(p) {
//  document.ovpnForm2.keystate.value=p;
//  document.ovpnForm2.submit();
}

function setKeymode() {
//  document.ovpnForm2.Datei.disabled = ! document.ovpnForm2.keymode[1].checked;
//  document.ovpnForm2.newkey.disabled = document.ovpnForm2.loadkey.disabled = document.ovpnForm2.keymode[1].checked;
}

function checkValues(i) {
  var result = true;
  switch (i) {
  case 1:
    if(result == true) {
      document.ovpnFormNone.submit();
    }
    break;
  case 2:    
    if (!isValidIP(document.ovpnFormClient.remote_host.value,"Server IP")){
	document.ovpnFormClient.remote_host.focus();
	return;
     }  
     if (isNaN(document.ovpnFormClient.remote_port.value) || document.ovpnFormClient.remote_port.value <=0 || document.ovpnFormClient.remote_port.value >=65535){
	alert(unescape("Port-Nummer: Die Portnummer muss zwischen 1 und 65534 liegen."));
	document.ovpnFormClient.remote_port.focus();
	return;
     }
     if (isNaN(document.ovpnFormClient.vport.value) || document.ovpnFormClient.vport.value <=0 || document.ovpnFormClient.vport.value >=65535){
	alert(unescape("Port-Nummer: Die Portnummer muss zwischen 1 und 65534 liegen."));
	document.ovpnFormClient.vport.focus();
	return;
     }
     if (document.ovpnFormClient.certfile.value.length>0 && document.ovpnFormClient.x509pwd.value.length==0){
       if (!confirm("Das Passwort des X509-Zertifikats wurde nicht gesetzt. Zertifikat ohne Passwort verwenden?")){
	document.ovpnFormClient.x509pwd.focus();
	return;
       }       
     }    
     document.ovpnFormClient.submit();
    break;
  case 3:    
    /*if (!isValidNet(document.ovpnFormServer.ovpnservermask.value,"VPN-Netzwerkmaske")){
      document.ovpnFormServer.ovpnservermask.focus();
      return;
    }*/
    if (!isValidIP(document.ovpnFormServer.ovpnservermsdns.value,"DNS-Server Adresse")){
      document.ovpnFormServer.ovpnservermsdns.focus();
      return;
    }
    if (!isValidIP(document.ovpnFormServer.ovpnservermswins.value,"WINS-Server Adresse")){
      document.ovpnFormServer.ovpnservermswins.focus();
      return;
    }
    if (isNaN(document.ovpnFormServer.ovpnservermaxclnts.value) || document.ovpnFormServer.ovpnservermaxclnts.value>254){
      alert(unescape("Die max. Anzahl der Clients ist ung%FCltig. Derzeit werden max. 254 Clients unterst%FCtzt"));
      document.ovpnFormServer.ovpnservermaxclnts.focus();
      return;
    }
    document.ovpnFormServer.submit();
    break;
  case 4:
     document.ovpnFormTunnel.submit();
     break;
  case 5:
    if(result == true) {
//      document.ovpnForm2.submit();
    }
    break;
  }
}

function choose(idx) {
  if (idx<0) idx = 0;
  for(i=0;i<document.ovpnFormServer.peer_list.length;++i) {
     document.ovpnFormServer.peer_list.options[i].selected=false;
     document.ovpnFormServer.mask_list.options[i].selected=false;
  }
  document.ovpnFormServer.peer_list.options[idx].selected=true;
  document.ovpnFormServer.mask_list.options[idx].selected=true;
}


function addEntry() {
  var peer=document.ovpnFormServer.ovpnpushroute.value;
  var mask=document.ovpnFormServer.ovpnpushmask.value;

  if(peer.length == 0) {
    alert("Bitte geben Sie eine Push-Route ein!");
    document.ovpnFormServer.ovpnpushroute.focus();
  } else {
    if(mask.length == 0) {
      alert("Bitte geben Sie eine Netzmaske ein!");
      document.ovpnFormServer.ovpnpushmask.focus();
    } else {
      var entry=new Option(peer, peer, false, false);
      var maske=new Option(mask, mask, false, false);
      document.ovpnFormServer.peer_list.options[document.ovpnFormServer.peer_list.length] = entry;
      document.ovpnFormServer.peerlist.value = document.ovpnFormServer.peerlist.value + peer + " ";
      document.ovpnFormServer.mask_list.options[document.ovpnFormServer.mask_list.length] = maske;
      document.ovpnFormServer.masklist.value = document.ovpnFormServer.masklist.value + mask + " ";
    }
  }
}


function delEntry() {
  if(document.ovpnFormServer.peer_list.selectedIndex != -1) {
    var index = document.ovpnFormServer.peer_list.selectedIndex;
    var peers = document.ovpnFormServer.peerlist.value;
    var masks = document.ovpnFormServer.masklist.value;
    var peerArray = peers.split(" ");
    var maskArray = masks.split(" ");
    var newpeers = "";
    var newmasks = "";

    for(i=0; i<document.ovpnFormServer.peer_list.length; ++i) {
      if(i!=index) {
        newpeers = newpeers + peerArray[i] + " ";
        newmasks = newmasks + maskArray[i] + " ";
      }
    }
    document.ovpnFormServer.peer_list.options[index] = null;
    document.ovpnFormServer.mask_list.options[index] = null;
    document.ovpnFormServer.peerlist.value = newpeers;
    document.ovpnFormServer.masklist.value = newmasks;
  } else {
    alert("Bitte waehlen Sie einen zu loeschenden Eintrag!");
  }
}

//-->
</script>
</head>
<body onLoad="chooseDiv({CHOOSEN_DIV});">
<form action="config.cgi" method="post" target="Main" name="ovpnForm">
  <input type="hidden" name="lang" value="deutsc">
  <input type="hidden" name="item" value="46">
  <input type="hidden" name="act" value="1">
  <table>
  <tr>
    <td>
      <input type="radio" name="vpnmode" value="none" onclick="chooseDiv(1);" {MODE_CHK1}>kein OpenVPN
      <input type="radio" name="vpnmode" value="client" onclick="chooseDiv(2);" {MODE_CHK2}>OpenVPN-Client
      <input type="radio" name="vpnmode" value="server" onclick="chooseDiv(3);" {MODE_CHK3}>OpenVPN-Server
      <!-- <input type="radio" name="vpnmode" value="tunnel" onclick="chooseDiv(4);" {MODE_CHK4}>OpenVPN-Tunnel -->
    </td>
  </tr>
  </table>
</form>

<!-- ******************************************************************************************** -->

<div id="1">
<form action="config.cgi" method="post" target="Main" name="ovpnFormNone">
  <input type="hidden" name="lang" value="deutsc">
  <input type="hidden" name="item" value="46">
  <input type="hidden" name="act" value="1">
  <input type="hidden" name="vpnmode" value="none">
  <fieldset><legend>kein OpenVPN</legend>
  <p>OpenVPN ist deaktiviert.</p>
  </fieldset>
  <table align="right">
  <tr>
    <td> <input type="reset" name="Cancel_Button" value="Abbrechen"> </td>
    <td> <input type="button" name="OK_Button" value="OVPN-Konfiguration &uuml;bernehmen" onclick="checkValues(1);"> </td>
  </tr>
  </table>
</form>
</div>

<!-- ******************************************************************************************** -->

<div id="2">
<form action="config.cgi" method="post" target="Main" name="ovpnFormClient" enctype="multipart/form-data">
  <input type="hidden" name="lang" value="deutsc">
  <input type="hidden" name="item" value="46">
  <input type="hidden" name="act" value="1">
  <input type="hidden" name="vpnmode" value="client">
  <fieldset><legend>VPN-Client</legend>
  <table>
  <tr>
    <td>Lokales&nbsp;Interface</td>
    <td><select name="ovpn_interface" size="1">{INTERFACE_OPTS}
        </select> </td>
    <td>Dient als OpenVPN-Interface auf diesem Router.</td>
  </tr>
  <tr>
    <td>Protokoll</td>
    <td colspan="2"><input type="radio" name="vpnprot" value="udp" {CHECK1}>UDP&nbsp;
                    <input type="radio" name="vpnprot" value="tcp" {CHECK2}>TCP</td>
  </tr>
  <tr>
    <td>Port</td>
    <td> <input type="text" size="10" maxlength="8" name="vport" value="{VPORT}"> </td>
    <td>VPN-Port</td>
  </tr>
  <tr>
    <td>Kompression</td>
    <td> <input type="checkbox" name="kompress" value="lzo" {KOMP}> </td>
    <td colspan="2">Aktiviert die Kompression im OpenVPN. Hier gilt Durchsatz vs. Rechenleistung! Bitte nur bei leistungsstarken VPN-Partnern (wie z.B. WaveLine-Router) erlauben!</td>
  </tr>
  <tr>
    <td>VPN-Gateway</td>
    <td> <input type="text" size="20" maxlength="16" name="remote_host" value="{OVPN_HOST_REMOTE}"> </td>
    <td>VPN-Gateway</td>
  </tr>
  <tr>
    <td>remote Port</td>
    <td> <input type="text" size="10" maxlength="8" name="remote_port" value="{OVPN_PORT_REMOTE}"> </td>
    <td>remote Port</td>
  </tr>
  <tr>
    <td>Zertifikat</td>
    <td> <input type="file" name="certfile"> </td>
    <td>Upload X.509-Zertifikat</td>
  </tr>
  <tr>
    <td>Passwort</td>
    <td><input type="password" name="x509pwd" size="15" maxlength="30" value=""></td>
    <td>Passwort zum Extrahieren aus dem PKCS#12-Container</td>
  </tr>
  </table>
  </fieldset>
  <table align="right">
  <tr>
    <td> <input type="reset" name="Cancel_Button" value="Abbrechen"> </td>
    <td> <input type="button" name="OK_Button" value="OVPN-Konfiguration &uuml;bernehmen" onclick="checkValues(2);"> </td>
  </tr>
  </table>
</form>
</div>

<!-- ******************************************************************************************** -->

<div id="3">
<form action="config.cgi" method="post" target="Main" name="ovpnFormServer">
  <input type="hidden" name="lang" value="deutsc">
  <input type="hidden" name="item" value="46">
  <input type="hidden" name="act" value="1">
  <input type="hidden" name="vpnmode" value="server">
  <fieldset><legend>VPN-Server</legend>
  <table>
  <tr>
    <td>Lokales Interface</td>
    <td><select name="ovpn_interface" size="1">{INTERFACE_OPTS}
        </select> </td>
    <td>Dient als OpenVPN-Interface auf diesem Router.</td>
  </tr>
  <tr>
    <td>Protokoll</td>
    <td colspan="2"><input type="radio" name="vpnprot" value="udp" {CHECK1}>UDP&nbsp;
                    <input type="radio" name="vpnprot" value="tcp" {CHECK2}>TCP</td>
  </tr>
  <tr>
    <td>Port</td>
    <td> <input type="text" size="10" maxlength="8" name="vport" value="{VPORT}"> </td>
    <td>VPN-Port</td>
  </tr>
  <tr>
    <td>Kompression</td>
    <td> <input type="checkbox" name="kompress" value="lzo" {KOMP}> </td>
    <td colspan="2">Aktiviert die Kompression im OpenVPN. Hier gilt Durchsatz vs. Rechenleistung! Bitte nur bei leistungsstarken VPN-Partnern (wie z.B. WaveLine-Router) erlauben!</td>
  </tr>
  </table>
  <table>
  <tr>
    <td>VPN-Netzwerk-Adresse</td>
    <td>
      <input type="text" size="20" maxlength="20" name="ovpnservernet" value="{OVPN_SVR_NET}">
    </td>
    <td>Lokales VPN-Subnetzwerk f&uuml;r OpenVPN-Peers, f&uuml;r welches Client Adressen vergeben werden.
        Der OpenVPN-Server erh&auml;lt automatisch die 1. Adresse in diesem VPN-Subnetzwerk.
    </td>
  </tr>
  <tr>
    <td>VPN-Netzwerk-Maske</td>
    <td>
      <input type="text" size="20" maxlength="20" name="ovpnservermask" value="{OVPN_SVR_MASK}">
    </td>
    <td>Netwerkmaske des lokalen VPN-Subnetzwerkes.</td>
  </tr>
  <tr>
    <td>DNS-Server Adresse</td>
    <td>
      <input type="text" size="20" maxlength="20" name="ovpnservermsdns" value="{OVPN_SVR_DNS}">
    </td>
    <td>DNS-Server f&uuml;r die Aufl&ouml;sung von Hostnamen in TCP/IP Netzwerken</td>
  </tr>
  <tr>
    <td>WINS-Server Adresse</td>
    <td>
      <input type="text" size="20" maxlength="20" name="ovpnservermswins" id="ovpnservermswins" value="{OVPN_SVR_WINS}">     
    </td>
    <td>WINS-Server f&uuml;r die Aufl&ouml;sung von NetBIOS-Namen in Windows-Netzwerken</td>
  </tr>
  <tr>
    <td>Ersetze Client-Defaults</td>
    <td>
      <input type="checkbox" name="ovpnredirectdefaults" onclick="" value="yes" {OVPN_SVR_REDIRECT_DEFAULT} >
    </td>
    <td>Konfiguriert den "Default Network-Gateway" aller verbundenen VPN-Clients auf die Adresse des OpenVPN-Servers.
        S&auml;mtlicher IP-Traffic wird somit &uuml;ber die VPN-Verbindung geleitet und geNATet.
    </td>
  </tr>
  <tr>
    <td>Maximum an Clients</td>
    <td><input type="text" size="10" maxlength="10" name="ovpnservermaxclnts" value="{OVPN_SVR_CLIENTS_MAX}"></td>
    <td>Die maximal erlaubte Anzahl von verbundenen VPN-Clients (empf.: 25).</td>
  </tr>
  <tr>
    <td>Client Visibility</td>
    <td>
      <input type="checkbox" name="ovpnclientsvisible" value="yes" {OVPN_SVR_CLIENT_VISIBILITY}>
    </td>
      <td>Alle verbundenen Netzwerkteilnehmer sind f&uuml;r alle verbundenen VPN-Clients sichtbar.</td>
  </tr>
  </table>
  </fieldset>
  <fieldset><legend>VPN Routing</legend>
    <table>
    <tr>
      <td width="60px">Push Route</td>
      <td><input type="text" name="ovpnpushroute" size="20" maxlength="15" value=""></td>
    </tr>
    <tr>
      <td>Push Route Netmask</td>
      <td><input type="text" name="ovpnpushmask" size="20" maxlength="15" value="">
        <input type="button" name="Add_ButtonPR" value="Hinzuf&uuml;gen" onclick="addEntry()">
      </td>
    </tr>
    <tr>
      <td colspan="2">Erlaubt die Erreichbarkeit von anderen privaten Subnetzen hinter dem OpenVPN-Server f&uuml;r verbundene VPN-Clients.</td>
    </tr>
    </table>
    <table>
     <tr>
     <td><select name="peer_list" size="4" onClick="choose(document.ovpnFormServer.peer_list.selectedIndex);">{PEEROPTS}
         </select>
     </td><td>
     <td><select name="mask_list" size="4" onClick="choose(document.ovpnFormServer.mask_list.selectedIndex);">{MASKOPTS}
         </select>
     </td><td>
        <input type="hidden" name="peerlist" value="{PEERLIST}">
        <input type="hidden" name="masklist" value="{MASKLIST}">
        <input type="button" name="Del_ButtonPR" value="L&ouml;schen" onclick="delEntry()"> </td>
    </tr>
    </table>
  <!-- VPN Routing -->
  </fieldset>
  <table align="right">
  <tr>
    <td> <input type="reset" name="Cancel_Button" value="Abbrechen"> </td>
    <td> <input type="button" name="OK_Button" value="OVPN-Konfiguration &uuml;bernehmen" onclick="checkValues(3);"> </td>
  </tr>
  </table>

</form>
</div>

<!-- ******************************************************************************************** -->
<!-- 
<div id="4">
<form action="config.cgi" method="post" target="Main" name="ovpnFormTunnel">
  <input type="hidden" name="lang" value="deutsc">
  <input type="hidden" name="item" value="46">
  <input type="hidden" name="act" value="1">
  <input type="hidden" name="vpnmode" value="tunnel">

  <fieldset><legend>VPN-Tunnel</legend>
  <table>
  <tr>
    <td><a href="/deutsc/hlp/ovpn_ifac_help.html" target="Help" title="Klick: Hilfe">Lokales Interface</a></td>
    <td><select name="ovpn_interface" size="1">{INTERFACE_OPTS}
        </select> </td>
    <td>Dient als OpenVPN-Interface auf diesem Router.</td>
  </tr>
  <tr>
    <td>Protokoll</td>
    <td width="80px"><input type="radio" name="vpnprot" value="udp" {CHECK1}>UDP&nbsp;
                     <input type="radio" name="vpnprot" value="tcp" {CHECK2}>TCP</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>Port</td>
    <td> <input type="text" size="10" maxlength="8" name="vport" value="{VPORT}"> </td>
    <td>VPN-Port</td>
  </tr>
  <tr>
    <td>Kompression</td>
    <td> <input type="checkbox" name="kompress" value="lzo" {KOMP}> </td>
    <td colspan="2">Aktiviert die Kompression im OpenVPN. Hier gilt Durchsatz vs. Rechenleistung! Bitte nur bei leistungsstarken VPN-Partnern (wie z.B. WaveLine-Router) erlauben!</td>
  </tr>
  </table>
  <table>
  <tr>
    <td>VPN-Gegenstelle</td>
    <td> <input type="" size="20" maxlength="20" name="gateway" value="{GATEWAY}"> </td>
    <td>IP-Adresse / DNS-Name</td>
  </tr>
  <tr>
    <td>Lokale Adresse</td>
    <td> <input type="text" size="20" maxlength="20" name="lokal" value="{LOKAL}"> </td>
    <td>lokale VPN-Tunnel-Adresse</td>
  </tr>
  <tr>
    <td>Entfernte Adresse</td>
    <td> <input type="text" size="20" maxlength="20" name="remote" value="{REMOTE}"> </td>
    <td>entfernte VPN-Tunnel-Adresse</td>
  </tr>
  </table>
  </fieldset>
  <table align="right">
  <tr>
    <td> <input type="reset" name="Cancel_Button" value="Abbrechen"> </td>
    <td> <input type="button" name="OK_Button" value="OVPN-Konfiguration &uuml;bernehmen" onclick="checkValues(4);"> </td>
  </tr>
  </table>
</form>
<br>
<form action="config.cgi" method="post" target="Main" name="ovpnForm2" enctype="multipart/form-data">
  <input type="hidden" name="lang" value="deutsc">
  <input type="hidden" name="item" value="46">
  <input type="hidden" name="act" value="0">
  <input type="hidden" name="keystate" value="0">
  <input type="hidden" name="vpnmode" value="tunnel">
  <fieldset><legend>Secret Key</legend>
  Generieren oder laden Sie den Key erst, wenn Sie die obigen Einstellungen gespeichert haben. Sonst gehen diese &Auml;nderungen verloren!
  <table>
  <tr>
    <td colspan="2">
      <input type="radio" name="keymode" value="no" checked onclick="setKeymode()">Generieren
      <input type="radio" name="keymode" value="yes" onclick="setKeymode()">Upload
    </td>
  </tr><tr>
    <td>{SECKEY}</td>
    <td>die ersten Stellen des Schl&uuml;ssels</td>
  </tr><tr>
    <td><input type="button" name="newkey" value="Generieren" onclick="setkeystate(1);"></td>
    <td><input type="button" name="loadkey" value="Download" onclick="location='openvpn/static.key'"></td>
  </tr><tr>
    <td colspan="2">&nbsp;</td>
  </tr><tr>
    <td colspan="2"><input name="Datei" type="file" size="50" maxlength="1000" accept="text/*">Key-Upload</td>
  </tr>
  </table>
  </fieldset>
  <table align="right">
  <tr>
    <td> <input type="reset" name="Cancel_Button2" value="Abbrechen"> </td>
    <td> <input type="button" name="OK_Button2" value="Key &uuml;bernehmen" onclick="setkeystate(3);"> </td>
  </tr>
  </table>
</form>
</div>
-->
</body>
</html>
