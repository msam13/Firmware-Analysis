

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="author" content="Henry Jesuiter, Enrico Kalliwoda">
<meta name="description" content="English toc-page of the IAR / Heyfra GmbH">
<meta name="date" content="2005-06-10 11:00:00">
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-store">
<meta http-equiv="expires" content="0">
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<title>OpenVPN configuration</title>
<link rel="stylesheet" type="text/css" href="css/stile.css" media="screen">
<style type="text/css">
<!--
div  { font-size:12px; position:absolute; top:40px; left:0px; height:auto; width:100%; visibility:hidden; }
-->
</style>
<script src="englis/auxfunc.js" type="text/javascript"></script>
<script type="text/javascript">
<!--

var onload_done = false;

function chooseDiv(number) {
//  for (i = 1;i < 5; ++i) {
  for (i = 1;i < 4; ++i) {
    document.getElementById(String(i)).style.visibility = (number==i ? "visible" : "hidden");
  }
  if (!onload_done) {
//    document.ovpnForm2.keymode[0].disabled = document.ovpnForm2.keymode[1].disabled =
//    document.ovpnForm2.newkey.disabled = document.ovpnForm2.loadkey.disabled =
//    document.ovpnForm2.Cancel_Button2.disabled = document.ovpnForm2.OK_Button2.disabled = (number==4) ? false : true;
//    document.ovpnForm2.Datei.disabled = (number==4 && document.ovpnForm2.keymode[1].checked) ? false : true;
    onload_done = true;
  }
}


function setkeystate(p) {
//  document.ovpnForm2.keystate.value=p;
//  document.ovpnForm2.submit();
}

function setKeymode() {
//  document.ovpnForm2.Datei.disabled = ! document.ovpnForm2.keymode[1].checked;
//  document.ovpnForm2.newkey.disabled = document.ovpnForm2.loadkey.disabled = document.ovpnForm2.keymode[1].checked;
}

function checkValues(i) {
  var result = true;
  switch (i) {
  case 1:
    if(result == true) {
      document.ovpnFormNone.submit();
    }
    break;
  case 2:
      if (!isValidIP(document.ovpnFormClient.remote_host.value,"Server IP")){
	document.ovpnFormClient.remote_host.focus();
	return;
     }  
     if (isNaN(document.ovpnFormClient.remote_port.value) || document.ovpnFormClient.remote_port.value <=0 || document.ovpnFormClient.remote_port.value >=65535){
	alert(unescape("Port Number: Port number has to be between 1 and 65534."));
	document.ovpnFormClient.remote_port.focus();
	return;
     }
     if (isNaN(document.ovpnFormClient.vport.value) || document.ovpnFormClient.vport.value <=0 || document.ovpnFormClient.vport.value >=65535){
	alert(unescape("Port Number: Port number has to be between 1 and 65534."));
	document.ovpnFormClient.vport.focus();
	return;
     }
     if (document.ovpnFormClient.x509pwd.value.length==0){
       if (!confirm("Password for X509 certificate has not been set. Use certificate without password?")){
	document.ovpnFormClient.x509pwd.focus();
	return;
       }       
     }    
     document.ovpnFormClient.submit();    
    break;
  case 3:
    /*if (!isValidNet(document.ovpnFormServer.ovpnservermask.value,"VPN netmask")){
      document.ovpnFormServer.ovpnservermask.focus();
      return;
    }*/
    if (!isValidIP(document.ovpnFormServer.ovpnservermsdns.value,"DNS server address")){
      document.ovpnFormServer.ovpnservermsdns.focus();
      return;
    }
    if (!isValidIP(document.ovpnFormServer.ovpnservermswins.value,"WINS server address")){
      document.ovpnFormServer.ovpnservermswins.focus();
      return;
    }
    if (isNaN(document.ovpnFormServer.ovpnservermaxclnts.value) || document.ovpnFormServer.ovpnservermaxclnts.value>254){
      alert(unescape("The maximum numbers of clients is invalid. Currently up to 254 clients are supported."));
      document.ovpnFormServer.ovpnservermaxclnts.focus();
      return;
    }
    document.ovpnFormServer.submit();          
    break;
  case 4:      
     document.ovpnFormTunnel.submit();      
     break;
  case 5:
    if(result == true) {
//      document.ovpnForm2.submit();
    }
    break;
  }
}

function choose(idx) {
  if (idx<0) idx = 0;
  for(i=0;i<document.ovpnFormServer.peer_list.length;++i) {
     document.ovpnFormServer.peer_list.options[i].selected=false;
     document.ovpnFormServer.mask_list.options[i].selected=false;
  }
  document.ovpnFormServer.peer_list.options[idx].selected=true;
  document.ovpnFormServer.mask_list.options[idx].selected=true;
}


function addEntry() {
  var peer=document.ovpnFormServer.ovpnpushroute.value;
  var mask=document.ovpnFormServer.ovpnpushmask.value;

  if(peer.length == 0) {
    alert("Please insert a push route!");
    document.ovpnFormServer.ovpnpushroute.focus();
  } else {
    if(mask.length == 0) {
      alert("Please insert a net mask!");
      document.ovpnFormServer.ovpnpushmask.focus();
    } else {
      var entry=new Option(peer, peer, false, false);
      var maske=new Option(mask, mask, false, false);
      document.ovpnFormServer.peer_list.options[document.ovpnFormServer.peer_list.length] = entry;
      document.ovpnFormServer.peerlist.value = document.ovpnFormServer.peerlist.value + peer + " ";
      document.ovpnFormServer.mask_list.options[document.ovpnFormServer.mask_list.length] = maske;
      document.ovpnFormServer.masklist.value = document.ovpnFormServer.masklist.value + mask + " ";
    }
  }
}


function delEntry() {
  if(document.ovpnFormServer.peer_list.selectedIndex != -1) {
    var index = document.ovpnFormServer.peer_list.selectedIndex;
    var peers = document.ovpnFormServer.peerlist.value;
    var masks = document.ovpnFormServer.masklist.value;
    var peerArray = peers.split(" ");
    var maskArray = masks.split(" ");
    var newpeers = "";
    var newmasks = "";

    for(i=0; i<document.ovpnFormServer.peer_list.length; ++i) {
      if(i!=index) {
        newpeers = newpeers + peerArray[i] + " ";
        newmasks = newmasks + maskArray[i] + " ";
      }
    }
    document.ovpnFormServer.peer_list.options[index] = null;
    document.ovpnFormServer.mask_list.options[index] = null;
    document.ovpnFormServer.peerlist.value = newpeers;
    document.ovpnFormServer.masklist.value = newmasks;
  } else {
    alert("Please choose an entry to delete!");
  }
}

//-->
</script>
</head>
<body onLoad="chooseDiv({CHOOSEN_DIV});">
<form action="config.cgi" method="post" target="Main" name="ovpnForm">
  <input type="hidden" name="lang" value="englis">
  <input type="hidden" name="item" value="46">
  <input type="hidden" name="act" value="1">
  <table>
  <tr>
    <td>
      <input type="radio" name="vpnmode" value="none" onclick="chooseDiv(1);" {MODE_CHK1}>no OpenVPN
      <input type="radio" name="vpnmode" value="client" onclick="chooseDiv(2);" {MODE_CHK2}>OpenVPN client
      <input type="radio" name="vpnmode" value="server" onclick="chooseDiv(3);" {MODE_CHK3}>OpenVPN server
      <!-- <input type="radio" name="vpnmode" value="tunnel" onclick="chooseDiv(4);" {MODE_CHK4}>OpenVPN tunnel -->
    </td>
  </tr>
  </table>
</form>

<!-- ******************************************************************************************** -->

<div id="1">
<form action="config.cgi" method="post" target="Main" name="ovpnFormNone">
  <input type="hidden" name="lang" value="englis">
  <input type="hidden" name="item" value="46">
  <input type="hidden" name="act" value="1">
  <input type="hidden" name="vpnmode" value="none">
  <fieldset><legend>no OpenVPN</legend>
  <p>OpenVPN is deactivated.</p>
  </fieldset>
  <table align="right">
  <tr>
    <td> <input type="reset" name="Cancel_Button" value="Cancel"> </td>
    <td> <input type="button" name="OK_Button" value="Apply OVPN configuration" onclick="checkValues(1);"> </td>
  </tr>
  </table>
</form>
</div>

<!-- ******************************************************************************************** -->

<div id="2">
<form action="config.cgi" method="post" target="Main" name="ovpnFormClient" enctype="multipart/form-data">
  <input type="hidden" name="lang" value="englis">
  <input type="hidden" name="item" value="46">
  <input type="hidden" name="act" value="1">
  <input type="hidden" name="vpnmode" value="client">
  <fieldset><legend>VPN client</legend>
  <table>
  <tr>
    <td>Local interface</td>
    <td><select name="ovpn_interface" size="1">{INTERFACE_OPTS}
        </select> </td>
    <td>used as OpenVPN interface on this router</td>
  </tr>
  <tr>
    <td>Protocol</td>
    <td colspan="2"><input type="radio" name="vpnprot" value="udp" {CHECK1}>UDP&nbsp;
                    <input type="radio" name="vpnprot" value="tcp" {CHECK2}>TCP</td>
  </tr>
  <tr>
    <td>Port</td>
    <td> <input type="text" size="10" maxlength="8" name="vport" value="{VPORT}"> </td>
    <td>VPN port</td>
  </tr>
  <tr>
    <td>Compression</td>
    <td> <input type="checkbox" name="kompress" value="lzo" {KOMP}> </td>
    <td colspan="2">Activates the compression in OpenVPN. Here stands flow rate vs. processing power! Only enable with powerful VPN partner (as it is the WaveLine-Router)!</td>
  </tr>
  <tr>
    <td>VPN gateway</td>
    <td> <input type="text" size="20" maxlength="16" name="remote_host" value="{OVPN_HOST_REMOTE}"> </td>
    <td>VPN gateway</td>
  </tr>
  <tr>
    <td>remote port</td>
    <td> <input type="text" size="10" maxlength="8" name="remote_port" value="{OVPN_PORT_REMOTE}"> </td>
    <td>remote port</td>
  </tr>
  <tr>
    <td>Certificate</td>
    <td> <input type="file" name="certfile"> </td>
    <td>Upload X.509 certificate</td>
  </tr>
  <tr>
    <td>Password</td>
    <td><input type="password" name="x509pwd" id="x509pwd" size="15" maxlength="30" value=""></td>
    <td>Password for extracting the pkcs#12 container</td>
  </tr>
  </table>
  </fieldset>
  <table align="right">
  <tr>
    <td> <input type="reset" name="Cancel_Button" value="Cancel"> </td>
    <td> <input type="button" name="OK_Button" value="Apply OVPN configuration" onclick="checkValues(2);"> </td>
  </tr>
  </table>
</form>
</div>

<!-- ******************************************************************************************** -->

<div id="3">
<form action="config.cgi" method="post" target="Main" name="ovpnFormServer">
  <input type="hidden" name="lang" value="englis">
  <input type="hidden" name="item" value="46">
  <input type="hidden" name="act" value="1">
  <input type="hidden" name="vpnmode" value="server">
  <fieldset><legend>VPN-Server</legend>
  <table>
  <tr>
    <td>Local interface</td>
    <td><select name="ovpn_interface" size="1">{INTERFACE_OPTS}
        </select> </td>
    <td>used as OpenVPN interface on this router</td>
  </tr>
  <tr>
    <td>protocol</td>
    <td colspan="2"><input type="radio" name="vpnprot" value="udp" {CHECK1}>UDP&nbsp;
                    <input type="radio" name="vpnprot" value="tcp" {CHECK2}>TCP</td>
  </tr>
  <tr>
    <td>port</td>
    <td> <input type="text" size="10" maxlength="8" name="vport" value="{VPORT}"> </td>
    <td>VPN port</td>
  </tr>
  <tr>
    <td>Compression</td>
    <td> <input type="checkbox" name="kompress" value="lzo" {KOMP}> </td>
    <td colspan="2">Activates the compression in OpenVPN. Here stands flow rate vs. processing power! Only enable with powerful VPN partner (as it is the WaveLine-Router)!</td>
  </tr>
  </table>
  <table>
  <tr>
    <td>VPN network address</td>
    <td>
      <input type="text" size="20" maxlength="20" name="ovpnservernet" id="ovpnservernet" value="{OVPN_SVR_NET}">
    </td>
    <td>Local VPN subnet for OpenVPN peers, client addresses are given to.
        The OpenVPN server automatically gets the first address in this VPN subnet.
    </td>
  </tr>
  <tr>
    <td>VPN netmask</td>
    <td>
      <input type="text" size="20" maxlength="20" name="ovpnservermask" id="ovpnservermask" value="{OVPN_SVR_MASK}">
    </td>
    <td>The local VPN subnet mask</td>
  </tr>
  <tr>
    <td>DNS server address</td>
    <td>
      <input type="text" size="20" maxlength="20" name="ovpnservermsdns" id="ovpnservermsdns" value="{OVPN_SVR_DNS}" >
    </td>
    <td>DNS server for die host name resolution in TCP/IP nets</td>
  </tr>
  <tr>
    <td>WINS server address</td>
    <td>
      <input type="text" size="20" maxlength="20" name="ovpnservermswins" id="ovpnservermswins" value="{OVPN_SVR_WINS}" >
    </td>
    <td>WINS server for NetBIOS name resolution in Windows nets</td>
  </tr>
  <tr>
    <td>Replace client defaults</td>
    <td>
      <input type="checkbox" name="ovpnredirectdefaults" onclick="" value="yes" {OVPN_SVR_REDIRECT_DEFAULT}  >
    </td>
    <td>Sets the "Default network gateway" of all connected VPN clients to the OpenVPN server's address.
        This way all IP traffic goes through the VPN connection und geNATet.
    </td>
  </tr>
  <tr>
    <td>Maximum number of clients</td>
    <td><input type="text" size="10" maxlength="10" name="ovpnservermaxclnts" value="{OVPN_SVR_CLIENTS_MAX}" ></td>
    <td>Maximum number of connected VPN clients.  (recom.: 25)</td>
  </tr>
  <tr>
    <td>Client visibility</td>
    <td>
      <input type="checkbox" name="ovpnclientsvisible" value="yes" {OVPN_SVR_CLIENT_VISIBILITY} >
    </td>
      <td>All connected network participiants are visible for all connected VPN clients.</td>
  </tr>
  </table>
  </fieldset>
  <fieldset><legend>VPN Routing</legend>
    <table>
    <tr>
      <td>Push route</td>
      <td><input type="text" name="ovpnpushroute" size="20" maxlength="15" value=""  ></td>
    </tr>
    <tr>
      <td>Push route netmask</td>
      <td><input type="text" name="ovpnpushmask" size="20" maxlength="15" value="">
        <input type="button" name="Add_ButtonPR" value="Add" onclick="addEntry()">
      </td>
    </tr>
    <tr>
      <td colspan="2">Enable access to other private subnets beyond the OpenVPN server for connected VPN clients.</td>
    </tr>
    </table>
    <table>
     <tr>
     <td><select name="peer_list" size="4" onClick="choose(document.ovpnFormServer.peer_list.selectedIndex);" >{PEEROPTS}
         </select>
     </td><td>
     <td><select name="mask_list" size="4" onClick="choose(document.ovpnFormServer.mask_list.selectedIndex);" >{MASKOPTS}
         </select>
     </td><td>
        <input type="hidden" name="peerlist" value="{PEERLIST}">
        <input type="hidden" name="masklist" value="{MASKLIST}">
        <input type="button" name="Del_ButtonPR" value="Delete" onclick="delEntry()"> </td>
    </tr>
    </table>
  <!-- VPN Routing -->
  </fieldset>
  <table align="right">
  <tr>
    <td> <input type="reset" name="Cancel_Button" value="Cancel"> </td>
    <td> <input type="button" name="OK_Button" value="Apply OVPN configuration" onclick="checkValues(3);"> </td>
  </tr>
  </table>

</form>
</div>

<!-- ******************************************************************************************** -->
<!-- 
<div id="4">
<form action="config.cgi" method="post" target="Main" name="ovpnFormTunnel">
  <input type="hidden" name="lang" value="englis">
  <input type="hidden" name="item" value="46">
  <input type="hidden" name="act" value="1">
  <input type="hidden" name="vpnmode" value="tunnel">

  <fieldset><legend>VPN tunnel</legend>
  <table>
  <tr>
    <td>Local interface</td>
    <td><select name="ovpn_interface" size="1">{INTERFACE_OPTS}
        </select> </td>
    <td>used as OpenVPN interface on this router</td>
  </tr>
  <tr>
    <td>protocol</td>
    <td width="80px"><input type="radio" name="vpnprot" value="udp" {CHECK1}>UDP&nbsp;
                     <input type="radio" name="vpnprot" value="tcp" {CHECK2}>TCP</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>port</td>
    <td> <input type="text" size="10" maxlength="8" name="vport" value="{VPORT}"> </td>
    <td>VPN port</td>
  </tr>
  <tr>
    <td>Compression</td>
    <td> <input type="checkbox" name="kompress" value="lzo" {KOMP}> </td>
    <td colspan="2">Activates the compression in OpenVPN. Here stands flow rate vs. processing power! Only enable with powerful VPN partner (as it is the WaveLine-Router)!</td>
  </tr>
  </table>
  <table>
  <tr>
    <td>VPN remote peer</td>
    <td> <input type="" size="20" maxlength="20" name="gateway" value="{GATEWAY}"> </td>
    <td>IP address / DNS name</td>
  </tr>
  <tr>
    <td>Local address</td>
    <td> <input type="text" size="20" maxlength="20" name="lokal" value="{LOKAL}"> </td>
    <td>local VPN tunnel address</td>
  </tr>
  <tr>
    <td>Remote address</td>
    <td> <input type="text" size="20" maxlength="20" name="remote" value="{REMOTE}"> </td>
    <td>remote VPN tunnel address</td>
  </tr>
  </table>
  </fieldset>
  <table align="right">
  <tr>
    <td> <input type="reset" name="Cancel_Button" value="Cancel"> </td>
    <td> <input type="button" name="OK_Button" value="Apply OpenVPN configuration" onclick="checkValues();"> </td>
  </tr>
  </table>
</form>
<br>
<form action="config.cgi" method="post" target="Main" name="ovpnForm2" enctype="multipart/form-data">
  <input type="hidden" name="lang" value="englis">
  <input type="hidden" name="item" value="46">
  <input type="hidden" name="act" value="0">
  <input type="hidden" name="keystate" value="0">
  <input type="hidden" name="vpnmode" value="tunnel">
  <fieldset><legend>Secret key</legend>
  Save the configurations above before generating or uploading the key! Otherwise your changes will be lost.
  <table>
  <tr>
    <td colspan="2">
      <input type="radio" name="keymode" value="no" checked onclick="setKeymode()">Generate
      <input type="radio" name="keymode" value="yes" onclick="setKeymode()">Upload
    </td>
  </tr><tr>
    <td>{SECKEY}</td>
    <td>The first characters of the key</td>
  </tr><tr>
    <td><input type="button" name="newkey" value="Generate" onclick="setkeystate(1);"></td>
    <td><input type="button" name="loadkey" value="Download" onclick="location='openvpn/static.key'"></td>
  </tr><tr>
    <td colspan="2">&nbsp;</td>
  </tr><tr>
    <td colspan="2"><input name="Datei" type="file" size="50" maxlength="1000" accept="text/*">Key-Upload</td>
  </tr>
  </table>
  </fieldset>
  <table align="right">
  <tr>
    <td> <input type="reset" name="Cancel_Button" value="Cancel"> </td>
    <td> <input type="button" name="OK_Button" value="Apply" onclick="setkeystate(3)"> </td>
  </tr>
  </table>
</form>
</div>
-->
</body>
</html>
